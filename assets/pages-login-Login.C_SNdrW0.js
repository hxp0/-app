import{g as e,Y as a,o as l,c as t,w as o,a as s,m as c,B as u,aa as n,i as r,ab as i,P as d,I as v,ac as p,t as m,f,q as _,k as g,l as y,F as k}from"./index-BNNjcVEM.js";import{i as h,q as w,j as x,k as I,C as V,m as C,n as b}from"./index.B3PZUrx7.js";import{_ as q}from"./plugin-vueexport-helper.BCo6x5W8.js";import{u as j}from"./userStore.DVSbzyDX.js";const S=q(e({__name:"Email",setup(e){const p=a(""),m=a(""),f=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/,_=()=>{0===p.value.length&&0===m.value.length?u({title:"请输入邮箱或者密码",icon:"error"}):f.test(p.value)?(async()=>{const e=await h(p.value,m.value);console.log(e),(e.code=200)?(u({title:"登录成功",icon:"success"}),d({url:"/pages/index/index"}),v("curCookie",e.cookie)):u({title:e.message,icon:"error"})})():u({title:"邮箱格式错误，请输入正确的邮箱",icon:"error"})};return(e,a)=>{const u=n,d=r,v=i;return l(),t(d,{class:"form"},{default:o((()=>[s(d,{class:"row"},{default:o((()=>[s(u,{type:"email",placeholder:"请输入邮箱",modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e)},null,8,["modelValue"])])),_:1}),s(d,{class:"row captcha"},{default:o((()=>[s(u,{type:"password",placeholder:"请输入密码",modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value=e)},null,8,["modelValue"])])),_:1}),s(d,{class:"row"},{default:o((()=>[s(v,{type:"primary",onClick:_},{default:o((()=>[c("登录")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-3bce4799"]]),U=q(e({__name:"Qr",setup(e){const n=j(),i=a(""),g=a("");a();const y=a("");let k;const h=async()=>{const e=await w();i.value=e.data.unikey;const a=await x(i.value);console.log(a),g.value=a.data.qrimg,k=setInterval((()=>{(async()=>{const e=await I(i.value);console.log(e),801===e.code||(802===e.code?(y.value="扫码成功，请在手机上确认",console.log(e.code)):800===e.code?(y.value="二维码已过期，请刷新",clearInterval(k)):803===e.code?(console.log(e),clearInterval(k),u({title:"登录成功",icon:"success"}),d({url:"/pages/index/index"}),v("curCookie",e.cookie),n.getLoginStatus()):console.log(e))})()}),5e3)};h();const V=()=>{y.value="",clearInterval(k),h()};return p((()=>{clearInterval(k)})),(e,a)=>{const u=_,n=r;return l(),t(n,{class:"qr-wrap"},{default:o((()=>[s(u,{mode:"widthFix",src:g.value},null,8,["src"]),y.value.length>0?(l(),t(n,{key:0,class:"qr-code",onClick:V},{default:o((()=>[c(m(y.value),1)])),_:1})):f("",!0)])),_:1})}}}),[["__scopeId","data-v-1f5efab4"]]),z=q(e({__name:"Phone",setup(e){const p=j(),f=a(),_=a("");let g;const y=a("获取验证码"),k=a(10),h=a(!1),w=async()=>{if(f.value){if(11!==f.value.toString().length)return u({title:"手机号格式错误",icon:"error"});g=setInterval((()=>{if(k.value--,y.value=k.value,h.value=!0,0===k.value)return clearInterval(g),k.value=10,y.value="获取验证码",void(h.value=!1)}),1e3);200===(await V(f.value)).code?u({title:"获取验证码成功",icon:"success"}):u({title:"获取验证码失败",icon:"none"})}else u({title:"请输入手机号",icon:"none"})},x=async()=>{if(f.value&&_.value){const e=await C(f.value,_.value);if(200===e.code){const e=await b(f.value,_.value);console.log(e),200===e.code?(u({title:"登录成功",icon:"success"}),setTimeout((()=>{d({url:"/pages/index/index"})}),2e3),v("curCookie",e.cookie),p.getLoginStatus()):u({title:e.message,icon:"error"})}else u({title:e.message,icon:"error"})}else u({title:"请输入手机号或者验证码",icon:"error"})};return(e,a)=>{const u=n,d=r,v=i;return l(),t(d,{class:"form"},{default:o((()=>[s(d,{class:"row"},{default:o((()=>[s(u,{type:"tel",placeholder:"请输入手机号",modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e),modelModifiers:{trim:!0}},null,8,["modelValue"])])),_:1}),s(d,{class:"row captcha"},{default:o((()=>[s(u,{type:"text",placeholder:"请输入验证码",modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=e=>_.value=e)},null,8,["modelValue"]),s(v,{type:"primary",onClick:w,disabled:h.value},{default:o((()=>[c(m(y.value),1)])),_:1},8,["disabled"])])),_:1}),s(d,{class:"row"},{default:o((()=>[s(v,{type:"primary",onClick:x},{default:o((()=>[c("登录")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-7626f284"]]),A=q(e({__name:"Login",setup(e){const u=a("phone"),n=[{text:"手机号登录",type:"phone"},{text:"邮箱登录",type:"email"},{text:"二维码登录",type:"qr"}];return(e,a)=>{const i=r;return l(),t(i,{class:"login"},{default:o((()=>["phone"===u.value?(l(),t(z,{key:0})):"email"===u.value?(l(),t(S,{key:1})):(l(),t(U,{key:2})),s(i,{class:"change-type"},{default:o((()=>[(l(),g(k,null,y(n,(e=>s(i,{key:e.type,class:"link",onClick:a=>u.value=e.type},{default:o((()=>[c(m(e.text),1)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})}}}),[["__scopeId","data-v-ecdc9f2f"]]);export{A as default};
