import{g as e,Y as a,aa as l,o as t,c as o,w as s,a as n,m as c,t as u,f as r,q as i,i as d,B as v,P as p,I as m,a9 as f,ab as _,k as y,l as g,F as k}from"./index-BDOIPGQE.js";import{_ as x}from"./plugin-vueexport-helper.BCo6x5W8.js";import{q as h,i as w,j as I,C,k as b}from"./index.QxF1F2_y.js";import{u as q}from"./userStore.cUOqCfGj.js";const V=x({},[["render",function(e,a){return" 邮箱登录 "}]]),j=x(e({__name:"Qr",setup(e){q();const f=a(""),_=a("");a();const y=a("");let g;const k=async()=>{const e=await h();f.value=e.data.unikey;const a=await w(f.value);_.value=a.data.qrimg,g=setInterval((()=>{(async()=>{const e=await I(f.value);console.log(e),801===e.code||(802===e.code?(y.value="扫码成功，请在手机上确认",console.log(e.code)):800===e.code?(y.value="二维码已过期，请刷新",clearInterval(g)):803===e.code?(console.log(e.code),clearInterval(g),v({title:"登录成功",icon:"success"}),p({url:"/pages/index/index"}),m("curCookie",e.cookie)):console.log(e))})()}),5e3)};k();const x=()=>{y.value="",clearInterval(g),k()};return l((()=>{clearInterval(g)})),(e,a)=>{const l=i,v=d;return t(),o(v,{class:"qr-wrap"},{default:s((()=>[n(l,{mode:"widthFix",src:_.value},null,8,["src"]),y.value.length>0?(t(),o(v,{key:0,class:"qr-code",onClick:x},{default:s((()=>[c(u(y.value),1)])),_:1})):r("",!0)])),_:1})}}}),[["__scopeId","data-v-6eb4fe79"]]),S=x(e({__name:"Phone",setup(e){const l=q(),r=a(),i=a("");let y;const g=a("获取验证码"),k=a(10),x=a(!1),h=async()=>{if(r.value){if(11!==r.value.toString().length)return v({title:"手机号格式错误",icon:"error"});y=setInterval((()=>{if(k.value--,g.value=k.value,x.value=!0,0===k.value)return clearInterval(y),k.value=10,g.value="获取验证码",void(x.value=!1)}),1e3);200===(await C(r.value)).code?v({title:"获取验证码成功",icon:"success"}):v({title:"获取验证码失败",icon:"none"})}else v({title:"请输入手机号",icon:"none"})},w=async()=>{if(r.value&&i.value){const e=await b(r.value,i.value);console.log(e),200===e.code?(v({title:"登录成功",icon:"success"}),setTimeout((()=>{p({url:"/pages/index/index"})}),2e3),m("curCookie",e.cookie),l.getLoginStatus()):v({title:e.message,icon:"error"})}else v({title:"请输入手机号或者验证码",icon:"error"})};return(e,a)=>{const l=f,v=d,p=_;return t(),o(v,{class:"form"},{default:s((()=>[n(v,{class:"row"},{default:s((()=>[n(l,{type:"tel",placeholder:"请输入手机号",modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e),modelModifiers:{trim:!0}},null,8,["modelValue"])])),_:1}),n(v,{class:"row captcha"},{default:s((()=>[n(l,{type:"text",placeholder:"请输入验证码",modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e)},null,8,["modelValue"]),n(p,{type:"primary",onClick:h,disabled:x.value},{default:s((()=>[c(u(g.value),1)])),_:1},8,["disabled"])])),_:1}),n(v,{class:"row"},{default:s((()=>[n(p,{type:"primary",onClick:w},{default:s((()=>[c("登录")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-cab9a275"]]),F=x(e({__name:"Login",setup(e){const l=a("phone"),r=[{text:"手机号登录",type:"phone"},{text:"邮箱登录",type:"email"},{text:"二维码登录",type:"qr"}];return(e,a)=>{const i=d;return t(),o(i,{class:"login"},{default:s((()=>["phone"===l.value?(t(),o(S,{key:0})):"email"===l.value?(t(),o(V,{key:1})):(t(),o(j,{key:2})),n(i,{class:"change-type"},{default:s((()=>[(t(),y(k,null,g(r,(e=>n(i,{key:e.type,class:"link",onClick:a=>l.value=e.type},{default:s((()=>[c(u(e.text),1)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})}}}),[["__scopeId","data-v-ecdc9f2f"]]);export{F as default};
